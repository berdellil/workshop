(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[402,639],{2660:function(e,t,n){"use strict";n.d(t,"e",function(){return f});var r=n(1090),i=n(36),s=n(530),o=n(54),u=n(8),a=(function(){function e(e,t){void 0===e&&(e={});this._pageContext=t.pageContext;this._apiUrlHelper=t.apiUrlHelper}e.prototype.getImageUrl=function(e){var t,n=this._pageContext,r=e.fullItemUrl;if(e.isCrossDomain){var i=r.indexOf("/_api/GroupService");if(i>-1){var u=r.substring(0,i),a=new o.t(r).getQueryParameter("id");t=this._apiUrlHelper.build().webByUrl({path:u}).method("GetFileById",{raw:"guid"+a}).segment("OpenBinaryStream").toString()}else t=n.webAbsoluteUrl+"/"+n.layoutsUrl+"/UserPhoto.aspx?"+Object(s.t)({URL:r,Default:"NONE",Size:"L"})}else t=r;return t};e.dependencies={pageContext:i.h,apiUrlHelper:r.e};return e})(),f=Object(u.s)("SiteIconHelper",a)},2773:function(e,t,n){"use strict";n.d(t,"e",function(){return s});var r=n(3),i=n(7),s=new i.t({name:"SitePinHelper.useMicroServiceForSitesLists",factory:new i.e(Object(r.ss)(r.Cn))})},2774:function(e,t,n){"use strict";n.d(t,"e",function(){return r});n.d(t,"n",function(){return i});n.d(t,"o",function(){return s});n.d(t,"i",function(){return o});n.d(t,"t",function(){return u});n.d(t,"s",function(){return a});n.d(t,"r",function(){return f});var r="SPHomeWeb:sites/feed",i={"SPHome-ClientType":"ODSPDocLibsWeb"},s={"SPHome-ClientType":"ODBWeb"},o=50,u=8,a=2,f="frequent"},2937:function(e,t,n){"use strict";n.d(t,"e",function(){return d});var r=n(0),i=n(474),s=n(389),o=n(69),u=n(1090),a=n(50),f=n(36),l=n(85),c=n(7),h=n(8),p=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this;r._pageContext=n.pageContext;r._apiUrlHelper=n.apiUrlHelper;r._dataRequestor=new n.dataRequestorType({qosName:"Sharepoint.SpHome"});return r}t.prototype.getData=function(e){var t=this,n=e.useMicroService,i=void 0===n||n,s=Object(r.__rest)(e,["useMicroService"]);return i?this._getDataRequestor().then(function(e){return e.getData(s).catch(function(e){l.e.log(e);return t._getDataFromSharePoint(s)})},function(e){l.e.log(e);return t._getDataFromSharePoint(s)}):this._getDataFromSharePoint(s)};t.prototype._getDataFromSharePoint=function(e){var t=e.url,n=Object(r.__rest)(e,["url"]),i=""+(new a.e(this._pageContext.webAbsoluteUrl).authority+"/_vti_bin/homeapi.ashx")+new a.e(t).path;return this._dataRequestor.getData(Object(r.__assign)(Object(r.__assign)({},n),{url:i}))};t.prototype._getDataRequestor=function(){var e,t=this,n=this._getContext().then(function(n){var i=n.d,u=i.Token,l=u.resource,h=u.access_token,p=u.expires_on,d=i.Payload;if("string"!=typeof h)return o.n.wrapError(new Error("SPHome context service did not produce a token."));var v=t.scope.attach(new c.n(t.resources));v.expose(f.h,{webAbsoluteUrl:l,authToken:h});var m=new(v.consume(s.n))({qosName:"SpHomeService"}),g=new a.e(l).authority+"/api/v1";e={resources:v,expiresOn:1e3*parseInt(p,10)};return{getData:function(e){var t=e.url,n=e.additionalHeaders,i=void 0===n?{}:n,s=Object(r.__rest)(e,["url","additionalHeaders"]),o=""+g+new a.e(t).path,u=Object(r.__assign)(Object(r.__assign)({},i),{"SPHome-ApiContext":d});return m.getData(Object(r.__assign)(Object(r.__assign)({},s),{url:o,additionalHeaders:u}))}}});this._getDataRequestor=function(){var r=Date.now();if(e&&e.expiresOn-r<6e5){e.resources.dispose();delete t._getDataRequestor;return t._getDataRequestor()}return n};return n};t.prototype._getContext=function(){var e=this._apiUrlHelper.build().segments("sphomeservice","context").oDataParameter("$expand","Token,Payload");return this._dataRequestor.getData({url:e.toString(),method:"GET",qosName:"GetContext",maxRetries:3})};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.e.dependencies),{pageContext:f.h,dataRequestorType:s.n,apiUrlHelper:u.e});return t})(i.e),d=Object(h.s)("SpHomeService",p)},2938:function(e,t,n){"use strict";n.d(t,"e",function(){return d});n.d(t,"t",function(){return g});var r=n(0),i=n(69),s=n(7),o=n(8),u=n(85),a=n(1664),f=n(36),l=n(2524),c=n(1151),h=n(114),p=n(77),d=new s.t({name:"JoinedSitesDataSource.isJoinedSitesEnabled",factory:new s.e(Object(p.isFeatureEnabled)(p.LeftNavTeamSiteLibraries))}),v=new s.t({name:"JoinedSitesDataSource.acronymAndColorDataSource",factory:{dependencies:{pageContext:f.h},create:function(e){return{instance:new a.e(e.pageContext)}}}}),m=(function(){function e(e,t){this._acronymAndColorDataSource=t.acronymAndColorDataSource;this._graphDataRequestor=t.graphDataRequestor;this._requestCache=new c.e({id:"JoinedSitesDataSource",cacheType:h.e.session},{});this._sortedGroups=[]}e.prototype.getJoinedSites=function(e,t){var n=this;return this.getGroups(e,t).then(function(e){if(e&&e.length>0){var t=[],r=n.getAcronymsAndColors(e);return n.getSitesInfo(e).then(function(n){return r.then(function(r){e.forEach(function(e){if(e){var i=n[e.id];n[e.id]&&r[e.displayName]&&t.push({id:e.id,title:e.displayName,serverRelativeUrl:i.siteUrl,itemReference:{SiteId:i.siteId,WebId:i.webId,GroupId:e.id},acronym:r[e.displayName].acronym,color:r[e.displayName].color,allowPinning:!!i.siteId&&!!i.webId})}});return t})})}return[]}).catch(function(e){u.e.logError(e);return[]})};e.prototype.getGroups=function(e,t){var n=this;if(this._sortedGroups&&this._sortedGroups.length>0)return i.n.resolve(this._sortedGroups.slice(e,e+t));var s="/me/memberOf/$/microsoft.graph.group?$filter=groupTypes/any(a:a%20eq%20%27unified%27)";return this._requestCache.getDataUtilizingCache({cacheRequestKey:this._requestCache.getRequestKey(s,"GET"),getData:function(){return n._graphDataRequestor.send({apiName:"JoinedSites.GetMemberGroups",path:s,useAuthorizationHeaders:!0})},cacheTimeoutTime:864e5}).then(function(i){n._sortedGroups=Object(r.__spreadArrays)(i.value);n._sortedGroups.sort(function(e,t){return e.displayName.localeCompare(t.displayName)});return n._sortedGroups.slice(e,e+t)}).catch(function(e){u.e.logError(e);n._sortedGroups=[];return[]})};e.prototype.getSitesInfo=function(e){var t=this,n=JSON.stringify({requests:e.map(function(e){return{id:e.id,method:"GET",url:"/groups/"+e.id+"/sites/root"}})});return this._requestCache.getDataUtilizingCache({cacheRequestKey:this._requestCache.getRequestKey("/$batch","POST",n),getData:function(){return t._graphDataRequestor.send({requestType:"POST",apiName:"JoinedSites.GetMemberGroups.GetSitesInfo",path:"/$batch",useAuthorizationHeaders:!0,postData:n})},cacheTimeoutTime:864e5}).then(function(e){var t=[];e&&e.responses&&e.responses.forEach(function(e){if(e.body&&e.body.webUrl){var n=void 0,r=void 0;if(e.body.id){var i=e.body.id.split(",");if(3===i.length){n=i[1];r=i[2]}}t[e.id]={siteUrl:e.body.webUrl,siteId:n,webId:r}}});return t}).catch(function(e){u.e.logError(e);return[]})};e.prototype.getAcronymsAndColors=function(e){return this._acronymAndColorDataSource.getAcronyms(e.map(function(e){return e.displayName})).then(function(e){var t=[];e&&e.forEach(function(e){e&&e.text&&e.acronym&&e.color&&(t[e.text]={acronym:e.acronym,color:e.color})});return t}).catch(function(e){u.e.logError(e);return[]})};e.dependencies={acronymAndColorDataSource:v,graphDataRequestor:l.e};return e})(),g=Object(o.s)("JoinedSitesDataSource",m)},3450:function(e,t,n){"use strict";n.r(t);n.d(t,"useMicroServiceForSitesListsResourceKey",function(){return C});n.d(t,"oneDrivePageDataCacheResourceKey",function(){return k});n.d(t,"resourceKey",function(){return A});var r,i=n(69),s=n(187),o=n(530),u=n(2660),a=n(2937),f=n(77),l=n(7),c=n(8),h=n(85),p=n(2938),d=n(53),v=n(369),m=n(84),g=n(44),y=n(36),b=n(1090),w=n(389);(function(e){e[e.itemCreated=0]="itemCreated";e[e.itemUpdated=1]="itemUpdated"})(r||(r={}));var E=(function(){function e(e,t){void 0===e&&(e={});this._dataRequestor=new t.dataRequestorType({qosName:"CacheList"});this._pageContext=t.pageContext;this._cachedData={};var n=this._pageContext,r=n.isSiteOwner,i=n.webTemplate,s=Number(i)===d.e.mySite;this._canReadOrWriteCache=!!r&&s;this._apiUrlHelper=t.apiUrlHelper}e.prototype.getValue=function(e){var t=this,n=new m.e({name:"CacheList_GetValue_"+e.key});if(!this._canReadOrWriteCache){n.end({resultType:g.e.ExpectedFailure,resultCode:"CanNotReadOrWriteCache"});return i.n.resolve()}if(!e.skipCache){var r=this.getValueSync(e);if(e.cacheExpiry&&r&&(new Date).getTime()-r.modifiedDate.getTime()>e.cacheExpiry){n.end({resultType:g.e.ExpectedFailure,resultCode:"CacheExpiry"});return i.n.resolve()}if(r||e.cacheOnly){r?n.end({resultType:g.e.Success}):n.end({resultType:g.e.Failure,resultCode:"CacheMissSync"});return i.n.resolve(r)}}return this.readCacheList().then(function(){var r=t.getValueSync(e);r?n.end({resultType:g.e.Success}):n.end({resultType:g.e.Failure,resultCode:"CacheMissSync"});return r})};e.prototype.createOrUpdateEntry=function(e){var t=this;return this._canReadOrWriteCache?this._hasCacheData?this._createOrUpdateEntry(e):this.readCacheList().then(function(){return t._createOrUpdateEntry(e)}):i.n.resolve({isSuccessful:!1,error:{message:"The user doesn't have permission to perform this task"}})};e.prototype.getValueSync=function(e){if(this._canReadOrWriteCache){var t=this._cachedData[this.getKey(e.key)];return!t||e.version&&t.version!==e.version?void 0:t}};e.prototype._createOrUpdateEntry=function(e){var t,n=this.getKey(e.key),r=this._cachedData[n];if(r){this._cachedData[n]={id:r.id,title:r.title,modifiedDate:new Date,value:e.value,version:e.version||""};t=this.updateEntry(r.id,e)}else t=this.createEntry(e);return t.catch(function(e){h.e.logError(e);return{isSuccessful:!1,error:e}})};e.prototype.getKey=function(e){return Number(this._pageContext.webTemplate)===d.e.mySite?"ODBWeb."+e:e};e.prototype.readCacheList=function(){var e=this,t=this._apiUrlHelper.build().segment("web").method("GetList",this.getCacheListBaseUrl()).segment("RenderListDataAsStream").toString(),n={"X-ServiceWorker-Strategy":"SkipCache","X-SP-REQUESTRESOURCES":"listUrl="+this.getCacheListBaseUrl()},r={requestDatesInUtc:!0,viewXml:v.r({fieldNames:["Title","Value","HashCode","CacheVersion","Modified"],pageSize:1e3,sortField:"Modified",isAscending:"false"})};return this._dataRequestor.getData({qosName:"ReadCacheList",additionalHeaders:n,method:"POST",url:t,additionalPostData:v.e(r),noRedirect:!0}).then(function(t){e._hasCacheData=!0;e.processResponse(t&&t.Row)}).catch(function(e){h.e.logError(e)})};e.prototype.updateEntry=function(e,t){var n=this._apiUrlHelper.build().segment("web").method("GetList",this.getCacheListBaseUrl()).method("items",e).segment("ValidateUpdateListItem()").toString(),i={"X-SP-REQUESTRESOURCES":"listUrl="+this.getCacheListBaseUrl()},s=[{FieldName:"Value",FieldValue:t.value}];t.version&&s.push({FieldName:"CacheVersion",FieldValue:t.version});var o={bNewDocumentUpdate:!1,formValues:s};return this._dataRequestor.getData({qosName:"UpdateCacheEntry",additionalHeaders:i,method:"POST",url:n,additionalPostData:JSON.stringify(o),noRedirect:!0}).then(function(e){return{updateType:r.itemUpdated,isSuccessful:!0}}).catch(function(e){return{updateType:r.itemUpdated,isSuccessful:!1,error:e}})};e.prototype.createEntry=function(e){var t=this,n=this._apiUrlHelper.build().segment("web").method("GetList",this.getCacheListBaseUrl()).segment("AddValidateUpdateItemUsingPath()").toString(),i={"X-SP-REQUESTRESOURCES":"listUrl="+this.getCacheListBaseUrl()},s=this.getKey(e.key),o=[{FieldName:"Title",FieldValue:s},{FieldName:"Value",FieldValue:e.value}];e.version&&o.push({FieldName:"CacheVersion",FieldValue:e.version});var u={bNewDocumentUpdate:!1,formValues:o};return this._dataRequestor.getData({qosName:"CreateCacheEntry",additionalHeaders:i,method:"POST",url:n,additionalPostData:JSON.stringify(u),noRedirect:!0}).then(function(n){try{for(var i=0,o=n.d.AddValidateUpdateItemUsingPath.results;i<o.length;i++){var u=o[i];"Id"===u.FieldName&&(t._cachedData[s]={id:u.FieldValue,title:s,modifiedDate:new Date,value:e.value,version:e.version||""})}}catch(e){}return{updateType:r.itemCreated,isSuccessful:!0}}).catch(function(e){return{updateType:r.itemCreated,isSuccessful:!1,error:e}})};e.prototype.processResponse=function(e){this._cachedData={};if(e&&e.length)for(var t=0,n=e;t<n.length;t++){var r=n[t];this._cachedData[r.Title]={id:r.ID,title:r.Title,value:r.Value,version:r.CacheVersion,modifiedDate:r.Modified&&new Date(r.Modified)||new Date}}};e.prototype.getCacheListBaseUrl=function(){return this._pageContext.webServerRelativeUrl+"/Lists/SharePointHomeCacheList"};e.dependencies={dataRequestorType:w.n,pageContext:y.h,apiUrlHelper:b.e};return e})(),S=Object(c.s)("CacheListDataSource",E),x=new l.t({name:"FilesWeightedFrequentSitesHelper.key.FrankieFrequentSites",factory:{dependencies:{},create:function(){return Object(f.isFeatureEnabled)(f.FrankieBasedFrequentSites)||Object(f.isFeatureEnabled)(f.ODBLeftNavPins)?{instance:!0}:{instance:!1}}}}),T=n(2773),N=n(2774),C=new l.t({name:"SitesDataSource.useMicroServiceForSitesLists",factory:new l.e(Object(f.isFeatureEnabled)(f.UseMicroServiceForSitesLists))}),k=new l.t({name:"SitesDataSource.oneDrivePageDataCache",factory:new l.e(window._spOneDrivePageDataCache)}),L=(function(){function e(e,t){this._cacheListDataSource=t.cacheListDataSource;this._itemUrlHelper=t.itemUrlHelper;this._joinedSitesDataSource=t.joinedSitesDataSource;this._oneDrivePageDataCache=t.oneDrivePageDataCache;this._spHomeService=t.spHomeService;this._siteIconHelper=t.siteIconHelper;this._useMicroServiceForSitesLists=t.useMicroServiceForSitesLists;this._isFilesWeightedFrequentSitesEnabled=t.isFilesWeightedFrequentSitesEnabled;this._isSitePinningEnabled=t.isSitePinningEnabled}e.prototype.getFollowedSites=function(e,t){var n=this,r={acronyms:!0,fillsitedata:!0,mostRecentFirst:!0,start:e,count:t},i="/sites/followed?"+Object(o.t)(r,null,!0);return this._spHomeService.getData({url:i,qosName:"GetFollowedSites",method:"GET",noRedirect:!0,additionalHeaders:N.n,useMicroService:this._useMicroServiceForSitesLists}).then(function(e){return n._parseSitesResponse(e)}).catch(function(e){h.e.logError(e);return[]})};e.prototype.getRecentSites=function(e,t){var n=this,r={acronyms:!0,start:e,count:t},i="/sites/recent?"+Object(o.t)(r,null,!0);return this._spHomeService.getData({url:i,qosName:"GetRecentSites",method:"GET",noRedirect:!0,additionalHeaders:N.n,useMicroService:this._useMicroServiceForSitesLists}).then(function(e){return n._parseSitesResponse(e)}).catch(function(e){h.e.logError(e);return[]})};e.prototype.getFrequentSites=function(e,t,n){var r=this;if(!n){if(this._isFilesWeightedFrequentSitesEnabled())return this._getFilesWeightedFrequentSites(e,t).then(function(e){return r._processFrequentSites(e,t)});var s=this._getFrequentSitesFromCache(e,t);if(s)return i.n.resolve(s)}var o={additionalHeaders:this._isFilesWeightedFrequentSitesEnabled()?N.o:N.n,startIndex:e,count:this._getFrequentSitesCount(t)};return this._getFrequentSites(o).then(function(e){var n=r._parseSitesResponse(e);return r._processFrequentSites(n,t)}).catch(function(e){h.e.logError(e);return[]})};e.prototype.getJoinedSites=function(e,t){return this._joinedSitesDataSource.getJoinedSites(e,t)};e.prototype._getFrequentSitesFromCache=function(e,t){void 0===e&&(e=0);void 0===t&&(t=0);var n=this._oneDrivePageDataCache,r=n&&n[N.e],i=r&&r.cacheValue,s=r&&r.cacheContext;return this._parseCachedFrequentSites(e,t,i,s,N.n)};e.prototype._getFilesWeightedFrequentSites=function(e,t){var n=this;return this._cacheListDataSource.getValue({key:"sites/feed"}).then(function(r){if(r){var i={ListItemId:parseInt(r.id,10)},s=n._parseCachedFrequentSites(e,n._getFrequentSitesCount(t),r.value,i,N.o);if(s)return s}var o={additionalHeaders:N.o,startIndex:e,count:n._getFrequentSitesCount(t)};return n._getFrequentSites(o).then(function(e){n._cacheListDataSource.createOrUpdateEntry({key:"sites/feed",value:JSON.stringify(e)});return n._parseSitesResponse(e)})}).catch(function(e){h.e.logError(e);return[]})};e.prototype._getFrequentSitesCount=function(e){return this._isSitePinningEnabled?N.i:e};e.prototype._processFrequentSites=function(e,t){void 0===t&&(t=0);if(this._isSitePinningEnabled&&e&&e.length>t){for(var n=[],r=0,i=Math.min(e.length,N.i);r<i&&e[r].pinOrder;r++)n.push(e[r]);var s=r,o=0;o=s>=t-N.s?N.s:t-s;i=Math.min(i,s+o);for(;r<i;r++)n.push(e[r]);return n}return e};e.prototype._parseCachedFrequentSites=function(e,t,n,r,i){void 0===e&&(e=0);void 0===t&&(t=0);try{if(n){var s=JSON.parse(n);if(s){if(s.Items.length>e){var o=t>0?Math.min(e+t,s.Items.length):s.Items.length,u=s.Items.slice(e,o);s.Items=u;this._getFrequentSitesWithCacheContext(e,t,r,i);return this._parseSitesResponse(s)}return new Array}}}catch(e){}};e.prototype._getFrequentSitesWithCacheContext=function(e,t,n,r){if(r&&n){var i=JSON.parse(JSON.stringify(r));i["SPHome-CacheContext"]=JSON.stringify(n);var s={additionalHeaders:i,startIndex:e,count:t};return this._getFrequentSites(s)}};e.prototype._getFrequentSites=function(e){var t={acronyms:!0,start:e.startIndex,count:e.count},n="/sites/feed?"+Object(o.t)(t,null,!0),r="GetFrequentSites";this._isFilesWeightedFrequentSitesEnabled()&&(r+=".Frankie");return this._spHomeService.getData({url:n,qosName:r,method:"GET",noRedirect:!0,additionalHeaders:e.additionalHeaders,useMicroService:this._useMicroServiceForSitesLists})};e.prototype._parseSitesResponse=function(e){var t=this;return e.Items.map(function(e){var n=e.ItemReference,r=n.WebId,i=n.SiteId,s=n.IndexId,o=e.Title,u=e.IsExternalContent,a=e.ItemReference,f=e.BannerImageUrl,l=e.BannerColor,c=e.Acronym,h=e.Weight,p=e.PinOrder,d=e.WebTemplate,v=e.OriginalUrl||e.Url;return{id:r,siteCollectionId:i,title:o,isExternal:u,serverRelativeUrl:v,icon:t._getIconUrl(f,v),color:l,acronym:c,indexId:s,itemReference:a,weight:h||0,pinOrder:p,allowPinning:!!a&&!!a.SiteId&&!!a.WebId,webTemplate:d}})};e.prototype._getIconUrl=function(e,t){var n;if(e){var r=this._itemUrlHelper.getUrlParts({path:e,webUrl:t});n=this._siteIconHelper.getImageUrl(r)}return n};e.dependencies={cacheListDataSource:S,itemUrlHelper:s.u,joinedSitesDataSource:p.t,oneDrivePageDataCache:k,siteIconHelper:u.e,spHomeService:a.e,useMicroServiceForSitesLists:C,isFilesWeightedFrequentSitesEnabled:x.lazy,isSitePinningEnabled:T.e};return e})(),A=(t.default=L,Object(c.s)("SitesDataSource",L))},4778:function(e,t,n){"use strict";n.r(t);n.d(t,"MAX_FOLLOWED_PAGE_SIZE",function(){return S});n.d(t,"MAX_JOINED_PAGE_SIZE",function(){return x});n.d(t,"resourceKey",function(){return N});var r=n(0),i=n(1602),s=n(69),o=n(387),u=n(3450),a=n(3594),f=n(1882),l=n(1850),c=n(2331),h=n(33),p=n(230),d=n(34),v=n(1908),m=n(36),g=n(8),y=n(93),b=n(2773),w=n(2774),E=n(2938),S=24,x=15,T=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this;r._sitesDataSource=n.sitesDataSource;r._subsiteItemResultProcessor=n.subsiteItemResultProcessor;r._itemTaskObserverType=n.itemTaskObserverType;r._pageContext=n.pageContext;r._isJoinedSitesEnabled=n.isJoinedSitesEnabled;r._isSitePinningEnabled=n.isSitePinningEnabled;var i=n.urlDataSource,s=new r._itemTaskObserverType,o=i.getRootItemKey(d.e.Subsites);s.update([new l.e(o).succeed({item:{key:o,type:p.e.Folder,folder:{}}})]);s.flush();return r}t.prototype.getItem=function(e){var t,n,r=this,i=e.parentKey,u=e.startIndex,a=void 0===u?0:u,f=e.pageSize,c=void 0===f?48:f,h=e.requestToken,m=e.skipCache,g=void 0!==m&&m,y=this._isSitePinningEnabled?w.t:12;c=Math.min(c,S);var b=0,E=!1,T=!1;this._pageContext.isSPO||(n=0);h&&(t=JSON.parse(h),a=t.startIndex,n=t.frequentCount,b=t.followedCount,E=t.isFollowedSitesComplete,T=t.isJoinedSitesComplete);var N="number"==typeof n,C=new this._itemTaskObserverType,k=v.C;C.update([new l.e(i).succeed({item:{key:i,name:k,displayName:k,type:p.e.Folder,queryType:d.e.Subsites,isPlaceholder:!1,isRootFolder:!0}})]);C.flush();var L,A,O=[];N||O.push(this._sitesDataSource.getFrequentSites(0,y,g).then(function(e){n=e.length;return{subsiteGroup:r._processGroup(e,{groupId:w.r,groupName:v.l,requestKey:i,observer:C})}},function(e){return{error:e}}));if(N){A=Math.max(0,a-n);L=c-Math.max(0,n-a)}else{A=0;L=a+c+y}var M=!0;N&&!E&&O.push(this._sitesDataSource.getFollowedSites(A,L+1).then(function(e){(M=e.length>L)&&e.pop();E=!M;b+=e.length;return{subsiteGroup:r._processGroup(e,{groupId:"followed",groupName:v.f,requestKey:i,observer:C})}},function(e){return{error:e}}));if(E&&this._isJoinedSitesEnabled){var _=Math.min(c,x),D=Math.max(0,a-n-b);O.push(this._sitesDataSource.getJoinedSites(D,_+1).then(function(e){(M=e.length>_)&&e.pop();T=!M;return{subsiteGroup:r._processGroup(e,{groupId:"Joined",groupName:v.p,requestKey:i,observer:C})}},function(e){return{error:e}}))}var P=new o.e;s.n.all(O).then(function(e){for(var t=0,s=[],o="",u=[],f=[],c=0,h=e;c<h.length;c++){var p=h[c];p.error?f.push(p.error):u.push(p.subsiteGroup)}if(0!==u.length){for(var d=0,v=u;d<v.length;d++){for(var m=v[d],g={name:m.groupName,groupingId:m.groupId,startIndex:t,count:m.keys.length,state:r.createObservable({isCollapsed:!1})},y=0,w=m.keys;y<w.length;y++){var S=w[y];C.update([new l.e(S).succeed({set:{parent:{key:i},after:{key:o}}})]);o=S}s.push(g);t+=g.count}C.flush();var x=C.getItem({key:i}),k=C.getChildren({parentKey:i}),L=void 0;if(!(r._isJoinedSitesEnabled?T:E)){var A={frequentCount:n,followedCount:b,isFollowedSitesComplete:E,isJoinedSitesComplete:T,startIndex:a+k.length};L=JSON.stringify(A)}var O=void 0;N||(O=0);var M={item:x,groupings:[{name:"type",isAllCollapsed:r.createObservable(!1),itemGroups:s}],children:k,totalChildren:k.length,startIndex:O,nextRequestToken:L,schema:r._getSchema()};C.dispose();P.complete(M)}else P.error(f)});return P.getPromise()};t.prototype._processGroup=function(e,t){for(var n=t.groupId,r=t.groupName,i=t.requestKey,s=t.observer,o=[],u=0;u<e.length;u++){var a=e[u],f=this._subsiteItemResultProcessor.processSubsite({subsite:a,requestKey:i,unique:n+"-"+u,observer:s}).key;this._subsiteItemResultProcessor.processSubsite({subsite:a,requestKey:i,observer:s});o.push(f)}return{groupName:r,groupId:n,keys:o}};t.prototype._getSchema=function(){return c.e.fillColumnDefinitionDefaults([{internalName:"IsContainer",key:"type",name:"",isIcon:!0,width:16,minWidth:16,fieldType:h.e.FileIcon},{internalName:"DocumentLibraryName",key:"name",name:v.y,isRowHeader:!0,width:220,fieldType:h.e.Name}],{isCollapsible:!1})};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.default.dependencies),{sitesDataSource:u.resourceKey,subsiteItemResultProcessor:a.e,itemTaskObserverType:f.resourceKey,pageContext:m.h,urlDataSource:y.pe,isJoinedSitesEnabled:E.e,isSitePinningEnabled:b.e});return t})(i.default);t.default=T;var N=Object(g.s)("SubsiteItemDataSource",T)}}]);